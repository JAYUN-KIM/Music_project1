server:
  # Promtail 자체의 상태 확인용 포트
  http_listen_port: {{ promtail_port | default(9080) }}

positions:
  # 로그 읽은 위치를 기록하는 파일 (중복 수집 방지)
  filename: {{ promtail_positions_path | default('/tmp/positions.yaml') }}

clients:
  # 로그를 전송할 Loki 서버 주소 (monitoring_server_ip 활용)
  - url: http://{{ monitoring_server_ip }}:{{ loki_port | default(3100) }}/loki/api/v1/push

scrape_configs:
  # 1. 시스템 로그 파일 수집
  - job_name: system_files
    static_configs:
    - targets: [localhost]
      labels:
        job: system_logs
        host: {{ inventory_hostname }}
        __path__: {{ system_log_path | default('/var/log/messages') }}

  # 2. Nginx 웹 로그 수집
  - job_name: nginx_logs
    static_configs:
    - targets: [localhost]
      labels:
        job: nginx_logs
        host: {{ inventory_hostname }}
        __path__: {{ nginx_log_path | default('/var/log/nginx/*.log') }}

  # 3. Journalctl (systemd) 로그 수집
  - job_name: journal
    journal:
      max_age: {{ journal_max_age | default('12h') }}
      labels:
        job: systemd_journal
        host: {{ inventory_hostname }}
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        target_label: 'unit'
